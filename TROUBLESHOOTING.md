# 故障排除指南

## 🚨 "Unexpected token '<', "<"... is not valid JSON" 錯誤解決方案

### 問題描述
當您在使用 AI 思考功能時遇到以下錯誤：
```
發生錯誤: Unexpected token '<', "<"... is not valid JSON
```

這表示前端期望收到 JSON 格式的回應，但實際收到了 HTML 或其他格式的內容。

### 🔍 診斷步驟

#### 1. 使用診斷工具
運行以下命令來診斷問題：
```bash
python test_zeabur_deployment.py https://your-app.zeabur.app
```

#### 2. 使用 API 金鑰檢測工具
訪問以下網址來檢測 API 金鑰狀態：
```
https://your-app.zeabur.app/api_test
```

#### 3. 檢查 Zeabur 部署狀態
1. 登入 [Zeabur 控制台](https://zeabur.com/)
2. 選擇您的專案
3. 檢查部署狀態是否為 "Running"
4. 查看日誌中是否有錯誤訊息

#### 4. 檢查環境變數
確保在 Zeabur 平台正確設定了以下環境變數：
- `DEEPSEEK_API_KEY`: 您的 DeepSeek API 金鑰

### 🛠️ 解決方案

#### 方案 1: 重新設定環境變數
1. 在 Zeabur 控制台中，進入專案設定
2. 刪除現有的 `DEEPSEEK_API_KEY` 環境變數
3. 重新新增環境變數：
   - 名稱：`DEEPSEEK_API_KEY`
   - 值：`sk-your_actual_api_key_here`
4. 重新部署應用程式

#### 方案 2: 檢查 API 金鑰有效性
1. 前往 [DeepSeek Platform](https://platform.deepseek.com/)
2. 檢查您的 API 金鑰是否仍然有效
3. 確認金鑰有足夠的使用配額

#### 方案 3: 重新部署應用程式
1. 在 Zeabur 控制台中，點擊 "Redeploy"
2. 等待部署完成
3. 測試應用程式功能

#### 方案 4: 檢查網路連線
1. 確認您的網路連線正常
2. 檢查是否有防火牆或代理設定阻擋請求
3. 嘗試使用不同的網路環境

### 🔧 進階故障排除

#### 檢查 Zeabur 日誌
1. 在 Zeabur 控制台中，點擊 "Logs" 標籤
2. 查看應用程式日誌
3. 尋找錯誤訊息，特別是：
   - API 金鑰相關錯誤
   - 網路連線錯誤
   - 應用程式啟動錯誤

#### 檢查瀏覽器開發者工具
1. 按 F12 開啟開發者工具
2. 切換到 "Network" 標籤
3. 嘗試使用 AI 思考功能
4. 查看 `/chat` 請求的詳細資訊：
   - 請求狀態碼
   - 回應內容類型
   - 回應內容

#### 常見錯誤代碼及解決方案

| 錯誤代碼 | 問題 | 解決方案 |
|---------|------|----------|
| 401 | API 金鑰無效 | 重新設定 API 金鑰 |
| 403 | 權限不足 | 檢查 DeepSeek 帳戶權限 |
| 429 | 請求次數超限 | 等待一段時間後重試 |
| 500 | 伺服器內部錯誤 | 檢查 Zeabur 日誌 |
| 502/503 | 服務暫時不可用 | 稍後重試 |

### 📞 尋求協助

如果以上步驟都無法解決問題：

1. **收集診斷資訊**：
   - 運行診斷工具的輸出結果
   - Zeabur 日誌截圖
   - 瀏覽器開發者工具的錯誤訊息

2. **聯絡支援**：
   - 檢查 [Zeabur 官方文件](https://docs.zeabur.com/)
   - 在 [Zeabur Discord](https://discord.gg/zeabur) 尋求協助
   - 聯絡 Zeabur 技術支援

### 🎯 預防措施

1. **定期檢查 API 金鑰**：確保金鑰有效且有足夠配額
2. **監控應用程式狀態**：定期檢查 Zeabur 部署狀態
3. **備份重要設定**：記錄重要的環境變數和配置
4. **測試部署**：每次更新後都要測試功能

### 📋 檢查清單

在部署到 Zeabur 之前，請確認：

- [ ] 所有必要的檔案都已上傳到 GitHub
- [ ] `requirements.txt` 包含所有依賴
- [ ] `Procfile` 設定正確
- [ ] 環境變數已正確設定
- [ ] API 金鑰有效且有足夠配額
- [ ] 應用程式在本地測試正常

---

**最後更新**：2024年12月
**版本**：1.0 